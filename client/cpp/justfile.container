# C++ client library - container version
# This file is mounted as 'justfile' inside the container
# Also used directly in CI container jobs
# Uses system packages for gRPC/protobuf (not vcpkg)

set shell := ["bash", "-c"]

TOP := `git rev-parse --show-toplevel`

default:
    @just --list

proto:
    cmake -B build && cmake --build build --target angzarr-client

configure:
    cmake -B build -DCMAKE_BUILD_TYPE=Release

build:
    cmake -B build && cmake --build build

test:
    cmake -B build && cmake --build build && ctest --test-dir build --output-on-failure

# Create release archive with checksums
archive VERSION:
    cd {{TOP}} && git archive --format=tar.gz --prefix=angzarr-client-cpp-{{VERSION}}/ -o client/cpp/angzarr-client-cpp-{{VERSION}}.tar.gz HEAD:client/cpp
    sha512sum angzarr-client-cpp-{{VERSION}}.tar.gz > angzarr-client-cpp-{{VERSION}}.tar.gz.sha512
