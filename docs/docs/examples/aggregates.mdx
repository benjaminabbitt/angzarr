---
sidebar_position: 2
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Aggregate Examples

Real handler examples from the poker domain. All code is from the actual [examples/](https://github.com/benjaminabbitt/angzarr/tree/main/examples) directory.

⍼ Angzarr supports two implementation styles:

| Style | Description | Best For |
|-------|-------------|----------|
| **OO (Object-Oriented)** | Aggregate class with `@handles`/`[Handles]` decorators | Rich domain models, encapsulation |
| **Imperative** | Pure `guard()`/`validate()`/`compute()` functions | Simple handlers, easy testing |

| Language | OO | Imperative |
|----------|:--:|:----------:|
| Python | ✓ | — |
| C# | ✓ | ✓ |
| Rust | ✓ | ✓ |
| Java | ✓ | ✓ |
| Go | — | ✓ |
| C++ | — | ✓ |

---

## Player: Reserve Funds

The Player aggregate demonstrates the **two-phase reservation pattern**. Funds are reserved before joining a table, then released if the join fails.

<Tabs groupId="language">
<TabItem value="python-oo" label="Python OO" default>

**[`examples/python/player/agg/handlers/player.py`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/python/player/agg/handlers/player.py)**

```python file=../../../examples/python/player/agg/handlers/player.py start=docs:start:reserve_funds_oo end=docs:end:reserve_funds_oo
```

</TabItem>
<TabItem value="csharp-oo" label="C# OO">

**[`examples/csharp/Player/Agg/Player.cs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/csharp/Player/Agg/Player.cs)**

```csharp file=../../../examples/csharp/Player/Agg/Player.cs start=docs:start:reserve_funds_oo end=docs:end:reserve_funds_oo
```

</TabItem>
<TabItem value="csharp-imp" label="C# Imperative">

**[`examples/csharp/Player/Agg/Handlers/ReserveHandler.cs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/csharp/Player/Agg/Handlers/ReserveHandler.cs)**

```csharp file=../../../examples/csharp/Player/Agg/Handlers/ReserveHandler.cs start=docs:start:reserve_funds_imp end=docs:end:reserve_funds_imp
```

</TabItem>
<TabItem value="rust-imp" label="Rust Imperative">

**[`examples/rust/player/agg/src/handlers/reserve.rs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/rust/player/agg/src/handlers/reserve.rs)**

```rust file=../../../examples/rust/player/agg/src/handlers/reserve.rs start=docs:start:reserve_funds_imp end=docs:end:reserve_funds_imp
```

</TabItem>
<TabItem value="java-oo" label="Java OO">

**[`examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java)**

```java file=../../../examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java start=docs:start:reserve_funds_oo end=docs:end:reserve_funds_oo
```

</TabItem>
<TabItem value="go" label="Go">

**[`examples/go/player/agg/handlers/reserve.go`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/go/player/agg/handlers/reserve.go)**

Go uses the imperative pattern (no OO aggregate base class):

```go file=../../../examples/go/player/agg/handlers/reserve.go start=docs:start:reserve_funds_imp end=docs:end:reserve_funds_imp
```

</TabItem>
<TabItem value="java-imp" label="Java Imperative">

**[`examples/java/player/agg/src/main/java/dev/angzarr/examples/player/handlers/ReserveHandler.java`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/java/player/agg/src/main/java/dev/angzarr/examples/player/handlers/ReserveHandler.java)**

```java file=../../../examples/java/player/agg/src/main/java/dev/angzarr/examples/player/handlers/ReserveHandler.java start=docs:start:reserve_funds_imp end=docs:end:reserve_funds_imp
```

</TabItem>
</Tabs>

---

## State Building

State is rebuilt by applying events. ⍼ Angzarr provides two patterns:

| Pattern | Description | Best For |
|---------|-------------|----------|
| **OO with `@applies`** | Decorators on aggregate class methods | Rich domain models |
| **StateRouter** | Fluent builder with typed event handlers | Clean separation, easy testing |

<Tabs groupId="language">
<TabItem value="python-oo" label="Python OO" default>

**[`examples/python/player/agg/handlers/player.py`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/python/player/agg/handlers/player.py)**

```python file=../../../examples/python/player/agg/handlers/player.py start=docs:start:state_appliers_oo end=docs:end:state_appliers_oo
```

</TabItem>
<TabItem value="csharp-router" label="C# StateRouter">

**[`examples/csharp/Player/Agg/PlayerState.cs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/csharp/Player/Agg/PlayerState.cs)**

```csharp file=../../../examples/csharp/Player/Agg/PlayerState.cs start=docs:start:state_router end=docs:end:state_router
```

</TabItem>
<TabItem value="rust-router" label="Rust StateRouter">

**[`examples/rust/player/agg/src/state.rs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/rust/player/agg/src/state.rs)**

```rust file=../../../examples/rust/player/agg/src/state.rs start=docs:start:state_router end=docs:end:state_router
```

</TabItem>
<TabItem value="java-oo" label="Java OO">

**[`examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java)**

```java file=../../../examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java start=docs:start:state_appliers_oo end=docs:end:state_appliers_oo
```

</TabItem>
<TabItem value="go-router" label="Go StateRouter">

**[`examples/go/player/agg/handlers/state.go`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/go/player/agg/handlers/state.go)**

```go file=../../../examples/go/player/agg/handlers/state.go start=docs:start:state_router end=docs:end:state_router
```

</TabItem>
<TabItem value="java-imp" label="Java StateBuilder">

**[`examples/java/player/agg/src/main/java/dev/angzarr/examples/player/handlers/StateBuilder.java`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/java/player/agg/src/main/java/dev/angzarr/examples/player/handlers/StateBuilder.java)**

```java file=../../../examples/java/player/agg/src/main/java/dev/angzarr/examples/player/handlers/StateBuilder.java start=docs:start:state_builder end=docs:end:state_builder
```

</TabItem>
</Tabs>

---

## Testing

⍼ Angzarr uses **Gherkin feature files as living specifications**. The same feature files run against all language implementations, guaranteeing identical business behavior.

**[`examples/features/unit/player.feature`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/features/unit/player.feature)**

```gherkin file=../../../examples/features/unit/player.feature start=docs:start:feature_overview end=docs:end:feature_overview
```

```gherkin file=../../../examples/features/unit/player.feature start=docs:start:registration_scenarios end=docs:end:registration_scenarios
```

```gherkin file=../../../examples/features/unit/player.feature start=docs:start:reservation_scenario end=docs:end:reservation_scenario
```

<Tabs groupId="language">
<TabItem value="python" label="Python" default>

**[`examples/python/tests/unit/test_player.py`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/python/tests/unit/test_player.py)**

```python file=../../../examples/python/tests/unit/test_player.py start=docs:start:bdd_imports end=docs:end:bdd_imports
```

```python file=../../../examples/python/tests/unit/test_player.py start=docs:start:scenarios_loader end=docs:end:scenarios_loader
```

```python file=../../../examples/python/tests/unit/test_player.py start=docs:start:given_step end=docs:end:given_step
```

```python file=../../../examples/python/tests/unit/test_player.py start=docs:start:when_step end=docs:end:when_step
```

```python file=../../../examples/python/tests/unit/test_player.py start=docs:start:then_step end=docs:end:then_step
```

</TabItem>
<TabItem value="rust" label="Rust">

**[`examples/rust/tests/tests/player.rs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/rust/tests/tests/player.rs)**

```rust file=../../../examples/rust/tests/tests/player.rs start=docs:start:world_struct end=docs:end:world_struct
```

```rust file=../../../examples/rust/tests/tests/player.rs start=docs:start:given_step end=docs:end:given_step
```

```rust file=../../../examples/rust/tests/tests/player.rs start=docs:start:when_step end=docs:end:when_step
```

```rust file=../../../examples/rust/tests/tests/player.rs start=docs:start:then_step end=docs:end:then_step
```

```rust file=../../../examples/rust/tests/tests/player.rs start=docs:start:main end=docs:end:main
```

</TabItem>
<TabItem value="go" label="Go">

**[`examples/go/tests/player_test.go`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/go/tests/player_test.go)**

```go file=../../../examples/go/tests/player_test.go start=docs:start:world_struct end=docs:end:world_struct
```

```go file=../../../examples/go/tests/player_test.go start=docs:start:given_step end=docs:end:given_step
```

```go file=../../../examples/go/tests/player_test.go start=docs:start:when_step end=docs:end:when_step
```

```go file=../../../examples/go/tests/player_test.go start=docs:start:then_step end=docs:end:then_step
```

```go file=../../../examples/go/tests/player_test.go start=docs:start:main end=docs:end:main
```

</TabItem>
</Tabs>

**Run tests:**

```bash
# Python - pytest-bdd
cd examples/python && pytest tests/unit/test_player.py

# Rust - cucumber-rs
cd examples/rust/tests && cargo test --test player

# Go - godog
cd examples/go && go test -v ./... --godog.tags=@player
```

---

## Next Steps

- **[Sagas](/examples/sagas)** — Cross-domain coordination
- **[Projectors](/examples/projectors)** — Read-side views
- **[Testing](/operations/testing)** — Full test strategy
- **[Why Poker](/examples/why-poker)** — Domain rationale
