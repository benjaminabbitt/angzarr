---
sidebar_position: 3
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Saga Examples

Cross-domain coordination examples from the poker domain.

---

## Saga: Table → Hand

When a table starts a hand, the **table-hand saga** translates the table domain's `HandStarted` event into a hand domain `DealCards` command.

⍼ Angzarr supports two saga implementation styles:

| Style | Description | Best For |
|-------|-------------|----------|
| **OO (Object-Oriented)** | Saga class with `@prepares`/`@reacts_to` decorators | Rich translation logic, type safety |
| **Functional** | EventRouter with function handlers | Simple mappings, composition |

| Language | OO | Functional |
|----------|:--:|:----------:|
| Python | ✓ | ✓ |
| Java | ✓ | ✓ |
| C# | — | ✓ |
| Rust | — | ✓ |
| Go | — | ✓ |
| C++ | — | ✓ |

<Tabs groupId="language">
<TabItem value="python-oo" label="Python OO" default>

**[`examples/python/table/saga-hand-oo/main.py`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/python/table/saga-hand-oo/main.py)**

```python file=examples/python/table/saga-hand-oo/main.py start=docs:start:saga_oo end=docs:end:saga_oo
```

</TabItem>
<TabItem value="java-oo" label="Java OO">

**[`examples/java/table/saga-hand/src/main/java/dev/angzarr/examples/table/sagahand/TableHandSaga.java`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/java/table/saga-hand/src/main/java/dev/angzarr/examples/table/sagahand/TableHandSaga.java)**

```java file=examples/java/table/saga-hand/src/main/java/dev/angzarr/examples/table/sagahand/TableHandSaga.java start=docs:start:saga_oo end=docs:end:saga_oo
```

</TabItem>
<TabItem value="csharp" label="C#">

**[`examples/csharp/Table/SagaHand/TableHandSaga.cs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/csharp/Table/SagaHand/TableHandSaga.cs)**

C# uses the functional pattern with EventRouter:

```csharp file=examples/csharp/Table/SagaHand/TableHandSaga.cs start=docs:start:saga_handler end=docs:end:saga_handler
```

</TabItem>
<TabItem value="go" label="Go">

**[`examples/go/table/saga-hand/main.go`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/go/table/saga-hand/main.go)**

Go uses the functional pattern with EventRouter:

```go file=examples/go/table/saga-hand/main.go start=docs:start:saga_handler end=docs:end:saga_handler
```

</TabItem>
<TabItem value="rust" label="Rust">

**[`examples/rust/table/saga-hand/src/main.rs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/rust/table/saga-hand/src/main.rs)**

Rust uses the functional pattern with EventRouter:

```rust file=examples/rust/table/saga-hand/src/main.rs start=docs:start:saga_handler end=docs:end:saga_handler
```

</TabItem>
<TabItem value="cpp" label="C++">

**[`examples/cpp/table/saga-hand/src/table_hand_saga.cpp`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/cpp/table/saga-hand/src/table_hand_saga.cpp)**

C++ uses the functional pattern with EventRouter:

```cpp file=examples/cpp/table/saga-hand/src/table_hand_saga.cpp start=docs:start:saga_handler end=docs:end:saga_handler
```

</TabItem>
</Tabs>

---

## Saga: Compensation

When a saga-issued command is rejected, the source aggregate receives a **Notification** and must emit compensation events. Use `@rejected` decorators to register handlers — no if/else chains needed.

<Tabs groupId="language">
<TabItem value="python" label="Python" default>

**[`examples/python/player/agg/handlers/player.py`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/python/player/agg/handlers/player.py)**

```python file=examples/python/player/agg/handlers/player.py start=docs:start:rejected_handler end=docs:end:rejected_handler
```

</TabItem>
<TabItem value="rust" label="Rust">

**[`examples/rust/player/agg/src/handlers/rejected.rs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/rust/player/agg/src/handlers/rejected.rs)**

```rust file=examples/rust/player/agg/src/handlers/rejected.rs start=docs:start:rejected_handler end=docs:end:rejected_handler
```

</TabItem>
<TabItem value="go" label="Go">

**[`examples/go/player/agg/handlers/revocation.go`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/go/player/agg/handlers/revocation.go)**

```go file=examples/go/player/agg/handlers/revocation.go start=docs:start:rejected_handler end=docs:end:rejected_handler
```

</TabItem>
<TabItem value="java" label="Java">

**[`examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java)**

```java file=examples/java/player/agg/src/main/java/dev/angzarr/examples/player/Player.java start=docs:start:rejected_handler end=docs:end:rejected_handler
```

</TabItem>
<TabItem value="csharp" label="C#">

**[`examples/csharp/Player/Agg/Player.cs`](https://github.com/benjaminabbitt/angzarr/blob/main/examples/csharp/Player/Agg/Player.cs)**

```csharp file=examples/csharp/Player/Agg/Player.cs start=docs:start:rejected_handler end=docs:end:rejected_handler
```

</TabItem>
</Tabs>

---

## Saga Principles

1. **Stateless** — Each event processed independently
2. **Minimal logic** — Just translate fields between domains
3. **Single source** — Events from one domain only
4. **Single target** — Commands to one domain only
5. **Use destination state** — Set sequence from destination's next_sequence()

---

## Running Sagas

### OO Pattern (Java/Python)

OO sagas use annotation-based routing. The framework discovers `@Prepares` and `@ReactsTo` methods via reflection:

<Tabs groupId="language">
<TabItem value="java" label="Java" default>

```java
// Main entry point
public static void main(String[] args) {
    SagaHandler handler = new SagaHandler(new TableHandSaga());
    SagaServer.run("saga-table-hand", "50411", handler);
}
```

</TabItem>
<TabItem value="python" label="Python">

```python
if __name__ == "__main__":
    handler = SagaHandler(TableHandSaga)
    run_saga_server("saga-table-hand", "50411", handler)
```

</TabItem>
</Tabs>

### Functional Pattern (C#/Go/Rust/C++)

Functional sagas use explicit router registration:

<Tabs groupId="language">
<TabItem value="csharp" label="C#" default>

```csharp file=examples/csharp/Table/SagaHand/TableHandSaga.cs start=docs:start:event_router end=docs:end:event_router
```

</TabItem>
<TabItem value="go" label="Go">

```go file=examples/go/table/saga-hand/main.go start=docs:start:event_router end=docs:end:event_router
```

</TabItem>
<TabItem value="rust" label="Rust">

```rust file=examples/rust/table/saga-hand/src/main.rs start=docs:start:event_router end=docs:end:event_router
```

</TabItem>
<TabItem value="cpp" label="C++">

```cpp file=examples/cpp/table/saga-hand/src/table_hand_saga.cpp start=docs:start:event_router end=docs:end:event_router
```

</TabItem>
</Tabs>

---

## Next Steps

- **[Aggregates](/examples/aggregates)** — Handler examples
- **[Process Managers](/components/process-manager)** — Multi-domain orchestration
- **[Testing](/operations/testing)** — Saga testing with Gherkin
