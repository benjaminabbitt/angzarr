syntax = "proto3";
package angzarr;
option go_package = "github.com/angzarr/angzarr/proto/angzarr";
option java_package = "dev.angzarr";
option java_multiple_files = true;
option csharp_namespace = "Angzarr";
option ruby_package = "Angzarr";

import "angzarr/types.proto";
import "google/protobuf/empty.proto";

// ProjectorService: client logic that projects events to read models
// client logic doesn't care about sync - coordinator decides
service ProjectorService {
  // Async projection - projector should persist and return
  rpc Handle (EventBook) returns (Projection);
  // Speculative processing - projector must avoid external side effects
  rpc HandleSpeculative (EventBook) returns (Projection);
}

// ProjectorCoordinatorService: orchestrates projection processing
service ProjectorCoordinatorService {
  // Sync processing - returns projection based on sync_mode
  rpc HandleSync (SyncEventBook) returns (Projection);
  // Async processing - fire and forget
  rpc Handle (EventBook) returns (google.protobuf.Empty);
  // Speculative processing - returns projection without side effects
  rpc HandleSpeculative (SpeculateProjectorRequest) returns (Projection);
}

// Request for speculative projector execution at a point in time.
message SpeculateProjectorRequest {
  EventBook events = 1;
  TemporalQuery point_in_time = 2;
}

