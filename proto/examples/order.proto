syntax = "proto3";
package examples;
option go_package = "github.com/angzarr/angzarr/proto/examples;examples";
option java_package = "dev.angzarr.examples";
option java_multiple_files = true;
option csharp_namespace = "Angzarr.Examples";
option ruby_package = "Angzarr::Examples";

import "google/protobuf/timestamp.proto";

// =============================================================================
// Order Domain - manages customer orders and payment
// =============================================================================

// Commands
message CreateOrder {
  string customer_id = 1;
  repeated LineItem items = 2;
  bytes customer_root = 3;         // customer aggregate root UUID for saga routing
  bytes cart_root = 4;             // cart aggregate root UUID for inventory reservation linking
}

message ApplyLoyaltyDiscount {
  int32 points = 1;           // loyalty points to use
  int32 discount_cents = 2;   // value of discount in cents
}

message SubmitPayment {
  string payment_method = 1;  // "card", "cash", etc.
  int32 amount_cents = 2;     // payment amount (must match total after discount)
}

message ConfirmPayment {
  string payment_reference = 1;  // external payment reference
}

message CancelOrder {
  string reason = 1;
}

// Events
message OrderCreated {
  string customer_id = 1;
  repeated LineItem items = 2;
  int32 subtotal_cents = 3;
  google.protobuf.Timestamp created_at = 4;
  bytes customer_root = 5;         // customer aggregate root UUID
  bytes cart_root = 6;             // cart aggregate root UUID for inventory reservation linking
}

message LoyaltyDiscountApplied {
  int32 points_used = 1;
  int32 discount_cents = 2;
  google.protobuf.Timestamp applied_at = 3;
}

message PaymentSubmitted {
  string payment_method = 1;
  int32 amount_cents = 2;
  google.protobuf.Timestamp submitted_at = 3;
}

message OrderCompleted {
  int32 final_total_cents = 1;
  string payment_method = 2;
  string payment_reference = 3;
  int32 loyalty_points_earned = 4;  // Points to award customer (1 point per $1)
  google.protobuf.Timestamp completed_at = 5;
  bytes customer_root = 6;         // customer aggregate root UUID for saga routing
  bytes cart_root = 7;             // cart aggregate root UUID for inventory reservation commit
  repeated LineItem items = 8;     // order items for inventory saga routing
  // External service enrichment - demonstrates calling ANY external REST/gRPC service
  // (pricing, tax, address validation, payment gateways, analytics/ML, etc.)
  string fraud_check_result = 9;   // "approved", "review_required", "declined" - from fraud service
}

message OrderCancelled {
  string reason = 1;
  google.protobuf.Timestamp cancelled_at = 2;
  int32 loyalty_points_used = 3;
  bytes customer_root = 4;         // customer aggregate root UUID for saga routing
  repeated LineItem items = 5;     // order items for inventory saga routing
  bytes cart_root = 6;             // cart aggregate root UUID for inventory reservation release
}

// Shared types
message LineItem {
  string product_id = 1;
  string name = 2;
  int32 quantity = 3;
  int32 unit_price_cents = 4;
  bytes product_root = 5;         // product/inventory aggregate root UUID for saga routing
}

// State (for snapshots)
message OrderState {
  string customer_id = 1;
  repeated LineItem items = 2;
  int32 subtotal_cents = 3;
  int32 discount_cents = 4;
  int32 loyalty_points_used = 5;
  string payment_method = 6;
  string payment_reference = 7;
  string status = 8;  // "pending", "payment_submitted", "completed", "cancelled"
  bytes customer_root = 9;        // customer aggregate root UUID
  bytes cart_root = 10;           // cart aggregate root UUID for inventory reservation linking
}
