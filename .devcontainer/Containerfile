# Root devcontainer for angzarr core development
# Uses custom base image from ghcr.io/angzarr

ARG RUST_IMAGE=ghcr.io/angzarr/angzarr-rust:latest
FROM ${RUST_IMAGE}

# Add podman for testcontainers support, mold linker, and build dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    podman \
    libsasl2-dev \
    mold \
    cmake \
    libcurl4-openssl-dev \
    && rm -rf /var/lib/apt/lists/* \
    && ln -sf /usr/bin/podman /usr/bin/docker

# Mark as devcontainer for justfile detection
ENV DEVCONTAINER=true

# Configure testcontainers to use the mounted podman socket
ENV DOCKER_HOST=unix:///run/podman/podman.sock
ENV TESTCONTAINERS_RYUK_DISABLED=true
