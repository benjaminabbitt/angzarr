# Tasks - Tasks

## In Progress


## To Do

- [ ] Saga/PM Shared Base: Refactor SagaRetryContext to remove execute_command and fetch_destination (5→3 methods), pass fetcher/executor to orchestrate_saga matching PM's pattern
- [ ] Saga/PM Shared Base: Simplify SagaEventHandler — remove 5 backwards-compat constructors (new, with_command_handler, with_routers, with_command_executor, with_config) and StubCommandExecutor; simplify GrpcSagaContextFactory and LocalSagaContextFactory
- [ ] Saga/PM Shared Base: Extract shared orchestration utils into src/orchestration/shared.rs — fetch_destinations(), fill_correlation_id(), execute_commands()
- [ ] Saga/PM Shared Base: Extract sidecar bootstrap into src/utils/sidecar.rs — bootstrap_sidecar(), connect_endpoints(), run_subscriber()

## Backlog

- [ ] Add e2e tests for reservation flow

## Done

- [x] Look for structural duplication in the codebase
- [x] Look for actual code duplication (copy-pasted logic, identical functions)
- [x] Look for opportunities to reuse/extend existing code with high cohesion to reduce codebase size
- [x] Extract EventBookExt trait with domain(), correlation_id(), root_id() methods
- [x] Consolidate bus helper functions (extract_domain, extract_root_id) into bus/mod.rs
- [x] Extract EventDistributionHandler filtering logic into reusable EventSubscriber trait
- [x] Create saga-inventory-reservation that reserves stock on ItemAdded to cart
- [x] Handle ItemRemoved and CartCleared to release reservations
- [x] Demonstrate the reservation pattern and document it
- [x] Add CommitReservation on OrderCompleted (or checkout)
- [x] Build Rust client library for angzarr gRPC services (similar to Full-Sail Python client in ../Full-Sail/src/full_sail/grpc/). Reference patterns from examples/rust/common and examples/rust/e2e. Library should expose typed clients for: gateway, aggregate, projector, saga, query. Adjust Cargo.toml workspace to include new crate (e.g., angzarr-client or clients/rust). Update examples to use the new client library instead of raw tonic calls.

## Deleted

- [ ] Consider moving next_sequence/event_book_metadata from examples/common to core lib
- [ ] Implement saga retry with exponential backoff on sequence conflict (runtime needs retry loop in EventDistributionHandler)
