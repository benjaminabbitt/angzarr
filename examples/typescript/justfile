# TypeScript examples
# Container: podman build -t angzarr-dev-typescript -f examples/typescript/Containerfile.dev .
# Run:       podman run --rm -v .:/app:Z -w /app/examples/typescript angzarr-dev-typescript just setup test

set shell := ["bash", "-c"]

TOP := `git rev-parse --show-toplevel`

# Show available commands
default:
    @just --list

# Build dev container
container-build:
    cd {{TOP}} && podman build -t angzarr-dev-typescript -f examples/typescript/Containerfile.dev .

# Run tests in container
container-test:
    cd {{TOP}} && podman run --rm -v .:/app:Z -w /app/examples/typescript angzarr-dev-typescript bash -c "just setup && just test"

# Install dependencies for all TypeScript examples
setup:
    cd customer && npm install
    cd transaction && npm install
    cd saga-loyalty && npm install
    cd projector-receipt && npm install
    cd projector-log-customer && npm install
    cd projector-log-transaction && npm install

# Build all TypeScript examples
build:
    cd customer && npm run build
    cd transaction && npm run build
    cd saga-loyalty && npm run build
    cd projector-receipt && npm run build
    cd projector-log-customer && npm run build
    cd projector-log-transaction && npm run build

# Test all TypeScript examples
test:
    cd customer && npm test
    cd transaction && npm test
    cd saga-loyalty && npm test
    cd projector-receipt && npm test
    cd projector-log-customer && npm test
    cd projector-log-transaction && npm test

# Clean all TypeScript examples
clean:
    rm -rf customer/node_modules customer/dist || true
    rm -rf transaction/node_modules transaction/dist || true
    rm -rf saga-loyalty/node_modules saga-loyalty/dist || true
    rm -rf projector-receipt/node_modules projector-receipt/dist || true
    rm -rf projector-log-customer/node_modules projector-log-customer/dist || true
    rm -rf projector-log-transaction/node_modules projector-log-transaction/dist || true

# Format all TypeScript code
fmt:
    cd customer && npm run format || npx prettier --write "src/**/*.ts"
    cd transaction && npm run format || npx prettier --write "src/**/*.ts"
    cd saga-loyalty && npm run format || npx prettier --write "src/**/*.ts"
    cd projector-receipt && npm run format || npx prettier --write "src/**/*.ts"
    cd projector-log-customer && npm run format || npx prettier --write "src/**/*.ts"
    cd projector-log-transaction && npm run format || npx prettier --write "src/**/*.ts"

# Lint all TypeScript code
lint:
    cd customer && npm run lint || npx eslint "src/**/*.ts"
    cd transaction && npm run lint || npx eslint "src/**/*.ts"
    cd saga-loyalty && npm run lint || npx eslint "src/**/*.ts"
    cd projector-receipt && npm run lint || npx eslint "src/**/*.ts"
    cd projector-log-customer && npm run lint || npx eslint "src/**/*.ts"
    cd projector-log-transaction && npm run lint || npx eslint "src/**/*.ts"

# Lint Helm chart
helm-lint:
    helm lint helm
