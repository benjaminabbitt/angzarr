# Customer Business Logic - TypeScript gRPC Server

set shell := ["bash", "-c"]

TOP := `git rev-parse --show-toplevel`

default:
    @just --list

# Install dependencies
install:
    npm install

# Build
build: install
    npm run build

# Run the server
run: build
    npm start

# Run in development mode
dev: install
    npm run dev

# Copy feature files from shared location
copy-features:
    rm -rf features
    cp -r {{TOP}}/examples/features .

# Run unit tests (no infrastructure required)
unit: install
    npm run test

# Run acceptance tests (requires Kind cluster)
acceptance: install copy-features
    ANGZARR_TEST_MODE=container npm run cucumber

# Run all tests
test: unit acceptance

# Run unit tests only
test-unit: unit

# Clean
clean:
    rm -rf dist node_modules
