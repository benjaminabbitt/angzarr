syntax = "proto3";
package examples;
option go_package = "github.com/angzarr/angzarr/proto/examples;examples";

import "google/protobuf/timestamp.proto";

// =============================================================================
// Customer Domain - manages customer profiles and loyalty points
// =============================================================================

// Commands
message CreateCustomer {
  string name = 1;
  string email = 2;
}

message AddLoyaltyPoints {
  int32 points = 1;
  string reason = 2;  // e.g., "transaction:uuid" or "promotion:welcome"
}

message RedeemLoyaltyPoints {
  int32 points = 1;
  string redemption_type = 2;  // e.g., "discount", "reward"
}

// Events
message CustomerCreated {
  string name = 1;
  string email = 2;
  google.protobuf.Timestamp created_at = 3;
}

message LoyaltyPointsAdded {
  int32 points = 1;
  int32 new_balance = 2;
  string reason = 3;
}

message LoyaltyPointsRedeemed {
  int32 points = 1;
  int32 new_balance = 2;
  string redemption_type = 3;
}

// State (for snapshots)
message CustomerState {
  string name = 1;
  string email = 2;
  int32 loyalty_points = 3;
  int32 lifetime_points = 4;
}

// =============================================================================
// Transaction Domain - manages purchases and discounts
// =============================================================================

// Commands
message CreateTransaction {
  string customer_id = 1;  // UUID as string
  repeated LineItem items = 2;
}

message ApplyDiscount {
  string discount_type = 1;  // "percentage", "fixed", "coupon"
  int32 value = 2;           // percentage (0-100) or cents
  string coupon_code = 3;    // optional coupon code
}

message CompleteTransaction {
  string payment_method = 1;
}

message CancelTransaction {
  string reason = 1;
}

// Events
message TransactionCreated {
  string customer_id = 1;
  repeated LineItem items = 2;
  int32 subtotal_cents = 3;
  google.protobuf.Timestamp created_at = 4;
}

message DiscountApplied {
  string discount_type = 1;
  int32 value = 2;
  int32 discount_cents = 3;
  string coupon_code = 4;
}

message TransactionCompleted {
  int32 final_total_cents = 1;
  string payment_method = 2;
  int32 loyalty_points_earned = 3;  // Points to award customer
  google.protobuf.Timestamp completed_at = 4;
}

message TransactionCancelled {
  string reason = 1;
  google.protobuf.Timestamp cancelled_at = 2;
}

// Shared types
message LineItem {
  string product_id = 1;
  string name = 2;
  int32 quantity = 3;
  int32 unit_price_cents = 4;
}

// State (for snapshots)
message TransactionState {
  string customer_id = 1;
  repeated LineItem items = 2;
  int32 subtotal_cents = 3;
  int32 discount_cents = 4;
  string discount_type = 5;
  string status = 6;  // "pending", "completed", "cancelled"
}

// =============================================================================
// Projections
// =============================================================================

// Receipt projection generated when a transaction completes
message Receipt {
  string transaction_id = 1;
  string customer_id = 2;
  repeated LineItem items = 3;
  int32 subtotal_cents = 4;
  int32 discount_cents = 5;
  int32 final_total_cents = 6;
  string payment_method = 7;
  int32 loyalty_points_earned = 8;
  google.protobuf.Timestamp completed_at = 9;
  string formatted_text = 10;  // Human-readable receipt text
}
