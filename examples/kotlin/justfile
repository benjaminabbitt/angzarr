# Kotlin examples
# Container: podman build --network=host -t angzarr-dev-kotlin -f examples/kotlin/Containerfile.dev .
# Run:       podman run --rm -v .:/app:Z -w /app/examples/kotlin angzarr-dev-kotlin just test

set shell := ["bash", "-c"]

TOP := `git rev-parse --show-toplevel`

# Show available commands
default:
    @just --list

# Build dev container (requires --network=host to cache Gradle deps)
container-build:
    cd {{TOP}} && podman build --network=host -t angzarr-dev-kotlin -f examples/kotlin/Containerfile.dev .

# Run tests in container
container-test:
    cd {{TOP}} && podman run --rm -v .:/app:Z -w /app/examples/kotlin angzarr-dev-kotlin just test

# Build all Kotlin examples
build:
    cd customer && gradle build -x test
    cd transaction && gradle build -x test
    cd saga-loyalty && gradle build -x test
    cd projector-receipt && gradle build -x test
    cd projector-log-customer && gradle build -x test
    cd projector-log-transaction && gradle build -x test

# Test all Kotlin examples
test:
    cd customer && gradle test
    cd transaction && gradle test
    cd saga-loyalty && gradle test
    cd projector-receipt && gradle test
    cd projector-log-customer && gradle test
    cd projector-log-transaction && gradle test

# Clean all Kotlin examples
clean:
    cd customer && gradle clean || true
    cd transaction && gradle clean || true
    cd saga-loyalty && gradle clean || true
    cd projector-receipt && gradle clean || true
    cd projector-log-customer && gradle clean || true
    cd projector-log-transaction && gradle clean || true

# Format all Kotlin code
fmt:
    cd customer && gradle ktlintFormat || true
    cd transaction && gradle ktlintFormat || true
    cd saga-loyalty && gradle ktlintFormat || true
    cd projector-receipt && gradle ktlintFormat || true
    cd projector-log-customer && gradle ktlintFormat || true
    cd projector-log-transaction && gradle ktlintFormat || true

# Lint all Kotlin code
lint:
    cd customer && gradle ktlintCheck
    cd transaction && gradle ktlintCheck
    cd saga-loyalty && gradle ktlintCheck
    cd projector-receipt && gradle ktlintCheck
    cd projector-log-customer && gradle ktlintCheck
    cd projector-log-transaction && gradle ktlintCheck

# Lint Helm chart
helm-lint:
    helm lint helm
