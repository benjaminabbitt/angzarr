# Loyalty Points Saga - Rust gRPC Server

set shell := ["bash", "-c"]

TOP := `git rev-parse --show-toplevel`

# Show available commands
default:
    @just --list

# Copy generated proto files
proto:
    mkdir -p src/proto
    cp "{{TOP}}/generated/rust/examples/examples.rs" src/proto/examples.rs

# Build the server
build: proto
    cargo build -p saga-loyalty --bin saga-loyalty-server

# Build release
build-release: proto
    cargo build -p saga-loyalty --bin saga-loyalty-server --release

# Run the server
run: build
    cargo run -p saga-loyalty --bin saga-loyalty-server

# Run with custom port
run-port port:
    PORT={{port}} cargo run -p saga-loyalty --bin saga-loyalty-server

# Run tests
test:
    cargo test -p saga-loyalty

# Clean build artifacts
clean:
    cargo clean -p saga-loyalty

# Check code
check:
    cargo check -p saga-loyalty

# Lint code
lint:
    cargo clippy -p saga-loyalty -- -D warnings
