# Rust example services for Angzarr
# See docs/port-conventions.md for port scheme (logic port = base + 3)

namespace: angzarr-rs

# Angzarr infrastructure images
angzarr:
  command:
    image: angzarr-entity:latest
    port: 50050  # Coordinator port for customer (base)
  query:
    port: 50051
  stream:
    image: angzarr-stream:latest
    port: 1315
  gateway:
    image: angzarr-gateway:latest
    port: 1316
    streamTimeoutSecs: 30

# client logic services (logic port = base + 3)
services:
  customer:
    image: rs-customer:latest
    port: 50053
    domain: customer
  product:
    image: rs-product:latest
    port: 50063
    domain: product
  inventory:
    image: rs-inventory:latest
    port: 50073
    domain: inventory
  order:
    image: rs-order:latest
    port: 50083
    domain: order
  cart:
    image: rs-cart:latest
    port: 50093
    domain: cart
  fulfillment:
    image: rs-fulfillment:latest
    port: 50103
    domain: fulfillment

# Projector services (logic port = base + 3)
projectors:
  accounting:
    image: rs-projector-accounting:latest
    port: 50143
  web:
    image: rs-projector-web:latest
    port: 50153

# Saga services (logic port = base + 3)
sagas:
  loyaltyEarn:
    image: rs-saga-loyalty-earn:latest
    port: 50113
  fulfillment:
    image: rs-saga-fulfillment:latest
    port: 50123
  cancellation:
    image: rs-saga-cancellation:latest
    port: 50133

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
  hosts:
    command: command.rs.angzarr.local
    query: query.rs.angzarr.local
    gateway: gateway.rs.angzarr.local

# Secrets (values should be provided via --set or external secrets)
secrets:
  # MongoDB connection
  mongodbUri: ""
  # RabbitMQ AMQP URL
  amqpUrl: ""

# Logging
logging:
  level: info
