# Standalone mode configuration for Go Poker example
# Run with: ANGZARR_CONFIG=examples/go/standalone.yaml ./target/debug/angzarr-standalone

storage:
  type: sqlite

messaging:
  type: channel

transport:
  type: uds
  uds:
    base_path: /tmp/angzarr-poker-go

standalone:
  aggregates:
    - domain: player
      port: 50201
      command: ["go", "run", "./player/agg"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go
        SERVICE_NAME: business
        DOMAIN: player
      storage:
        type: sqlite
        sqlite:
          path: ./examples/go/data/player.db

    - domain: table
      port: 50202
      command: ["go", "run", "./table/agg"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go
        SERVICE_NAME: business
        DOMAIN: table
      storage:
        type: sqlite
        sqlite:
          path: ./examples/go/data/table.db

    - domain: hand
      port: 50203
      command: ["go", "run", "./hand/agg"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go
        SERVICE_NAME: business
        DOMAIN: hand
      storage:
        type: sqlite
        sqlite:
          path: ./examples/go/data/hand.db

  sagas:
    - name: saga-table-hand
      port: 50211
      source_domain: table
      target_domain: hand
      command: ["go", "run", "./table/saga-hand"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go

    - name: saga-hand-table
      port: 50212
      source_domain: hand
      target_domain: table
      command: ["go", "run", "./hand/saga-table"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go

    - name: saga-table-player
      port: 50213
      source_domain: table
      target_domain: player
      command: ["go", "run", "./table/saga-player"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go

    - name: saga-hand-player
      port: 50214
      source_domain: hand
      target_domain: player
      command: ["go", "run", "./hand/saga-player"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go

  process_managers:
    - name: hand-flow
      port: 50291
      pm_domain: hand-flow
      input_domains: [table, hand]
      command: ["go", "run", "./hand-flow"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go

  projectors:
    - name: prj-output
      port: 50290
      listen_domains: [player, table, hand]
      command: ["go", "run", "./prj-output"]
      env:
        UDS_BASE_PATH: /tmp/angzarr-poker-go
        HAND_LOG_FILE: ./hand_log.txt

  gateway:
    enabled: true
    port: 9084
