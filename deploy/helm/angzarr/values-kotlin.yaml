# Kotlin example applications for local development

global:
  security:
    allowInsecureImages: true

replicaCount: 1

images:
  entity:
    repository: angzarr-entity
    pullPolicy: Never
    tag: "latest"
  projector:
    repository: angzarr-projector
    pullPolicy: Never
    tag: "latest"
  saga:
    repository: angzarr-saga
    pullPolicy: Never
    tag: "latest"
  stream:
    repository: angzarr-stream
    pullPolicy: Never
    tag: "latest"
  gateway:
    repository: angzarr-gateway
    pullPolicy: Never
    tag: "latest"

resources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "256Mi"
    cpu: "250m"

applicationResources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

storage:
  type: mongodb
  mongodb:
    uri: "mongodb://angzarr:angzarr@angzarr-mongodb:27017"
    database: "angzarr"

amqp:
  enabled: true
  url: "amqp://guest:guest@angzarr-rabbitmq:5672"

rabbitmq:
  enabled: true
  image:
    registry: docker.io
    repository: library/rabbitmq
    tag: "3.13-management-alpine"
    pullPolicy: Never
  auth:
    username: "guest"
    password: "guest"
  persistence:
    size: 1Gi

mongodb:
  enabled: true
  image:
    registry: docker.io
    repository: library/mongo
    tag: "7"
    pullPolicy: Never
  auth:
    rootUsername: "root"
    rootPassword: "rootpassword"
    usernames: ["angzarr"]
    passwords: ["angzarr"]
    databases: ["angzarr"]
  persistence:
    size: 2Gi

infrastructure:
  stream:
    enabled: false
  gateway:
    enabled: true
    replicas: 1
    port: 1316
    entities:
      customer: "angzarr-entity-customer-kt:50051"
      transaction: "angzarr-entity-transaction-kt:50051"
    streamService: "angzarr-stream-kt:1315"
    streamTimeoutSecs: 30

applications:
  business:
    - name: entity-customer-kt
      image:
        repository: entity-customer-kt
        tag: "latest"
        pullPolicy: Never
      domain: "customer"
      port: 50500

    - name: entity-transaction-kt
      image:
        repository: entity-transaction-kt
        tag: "latest"
        pullPolicy: Never
      domain: "transaction"
      port: 50501

  projectors:
    - name: stream-kt
      image:
        repository: angzarr-stream
        tag: "latest"
        pullPolicy: Never
      port: 1315
      topics:
        - "#"

    - name: projector-receipt-kt
      image:
        repository: projector-receipt-kt
        tag: "latest"
        pullPolicy: Never
      port: 50503
      topics:
        - "transaction.*"

    - name: projector-log-customer-kt
      image:
        repository: projector-log-customer-kt
        tag: "latest"
        pullPolicy: Never
      port: 50504
      topics:
        - "customer.*"

    - name: projector-log-transaction-kt
      image:
        repository: projector-log-transaction-kt
        tag: "latest"
        pullPolicy: Never
      port: 50505
      topics:
        - "transaction.*"

  sagas:
    - name: saga-loyalty-kt
      image:
        repository: saga-loyalty-kt
        tag: "latest"
        pullPolicy: Never
      port: 50502
      topics:
        - "transaction.*"

service:
  type: NodePort
  entityPort: 50051
  queryPort: 50052

logging:
  level: info

autoscaling:
  enabled: false

reloader:
  enabled: false

serviceDiscovery:
  headless: false
