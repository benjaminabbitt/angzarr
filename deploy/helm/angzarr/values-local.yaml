# Local development values for angzarr
# Uses MongoDB + RabbitMQ with example applications

replicaCount: 1

image:
  repository: angzarr
  pullPolicy: Never  # Use local images (minikube/kind)
  tag: "latest"

resources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "256Mi"
    cpu: "250m"

# MongoDB storage (shared across all aggregates)
storage:
  type: mongodb
  mongodb:
    uri: "mongodb://angzarr:angzarr@angzarr-mongodb:27017"
    database: "angzarr"

# AMQP for event bus
amqp:
  enabled: true
  url: "amqp://guest:guest@angzarr-rabbitmq:5672"

# RabbitMQ subchart
rabbitmq:
  enabled: true
  auth:
    username: "guest"
    password: "guest"
  persistence:
    size: 1Gi
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "250m"

# MongoDB subchart
mongodb:
  enabled: true
  auth:
    rootUsername: "root"
    rootPassword: "rootpassword"
    usernames: ["angzarr"]
    passwords: ["angzarr"]
    databases: ["angzarr"]
  # NodePort for external test access (mongodb_debug.rs expects port 30017)
  service:
    type: NodePort
    nodePorts:
      mongodb: 30017
  persistence:
    size: 2Gi
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Example applications - each gets angzarr as sidecar
applications:
  # client logic aggregates
  business:
    # Rust customer aggregate
    - name: entity-customer-rs
      image:
        repository: entity-customer-rs
        tag: "latest"
        pullPolicy: Never
      domain: "customer"
      port: 50052

    # Rust transaction aggregate
    - name: entity-transaction-rs
      image:
        repository: entity-transaction-rs
        tag: "latest"
        pullPolicy: Never
      domain: "transaction"
      port: 50053

    # Go customer aggregate
    - name: entity-customer-go
      image:
        repository: entity-customer-go
        tag: "latest"
        pullPolicy: Never
      domain: "customer"
      port: 50052

    # Go transaction aggregate
    - name: entity-transaction-go
      image:
        repository: entity-transaction-go
        tag: "latest"
        pullPolicy: Never
      domain: "transaction"
      port: 50053

    # Python customer aggregate
    - name: entity-customer-py
      image:
        repository: entity-customer-py
        tag: "latest"
        pullPolicy: Never
      domain: "customer"
      port: 50052

    # Python transaction aggregate
    - name: entity-transaction-py
      image:
        repository: entity-transaction-py
        tag: "latest"
        pullPolicy: Never
      domain: "transaction"
      port: 50053

  # Projector applications
  projectors:
    # Receipt projector (synchronous - returns projection in command response)
    - name: projector-receipt-rs
      image:
        repository: projector-receipt-rs
        tag: "latest"
        pullPolicy: Never
      port: 50055
      topics:
        - "transaction.*"

    # Log projectors - customer domain
    - name: projector-log-customer-rs
      image:
        repository: projector-log-customer-rs
        tag: "latest"
        pullPolicy: Never
      port: 50056
      topics:
        - "customer.*"

    - name: projector-log-customer-go
      image:
        repository: projector-log-customer-go
        tag: "latest"
        pullPolicy: Never
      port: 50058
      topics:
        - "customer.*"

    - name: projector-log-customer-py
      image:
        repository: projector-log-customer-py
        tag: "latest"
        pullPolicy: Never
      port: 50060
      topics:
        - "customer.*"

    # Log projectors - transaction domain
    - name: projector-log-transaction-rs
      image:
        repository: projector-log-transaction-rs
        tag: "latest"
        pullPolicy: Never
      port: 50057
      topics:
        - "transaction.*"

    - name: projector-log-transaction-go
      image:
        repository: projector-log-transaction-go
        tag: "latest"
        pullPolicy: Never
      port: 50059
      topics:
        - "transaction.*"

    - name: projector-log-transaction-py
      image:
        repository: projector-log-transaction-py
        tag: "latest"
        pullPolicy: Never
      port: 50061
      topics:
        - "transaction.*"

  # Saga applications
  sagas:
    # Loyalty saga - subscribes to transactions, issues loyalty commands
    - name: saga-loyalty-rs
      image:
        repository: saga-loyalty-rs
        tag: "latest"
        pullPolicy: Never
      port: 50054
      topics:
        - "transaction.*"

    - name: saga-loyalty-go
      image:
        repository: saga-loyalty-go
        tag: "latest"
        pullPolicy: Never
      port: 50054
      topics:
        - "transaction.*"

    - name: saga-loyalty-py
      image:
        repository: saga-loyalty-py
        tag: "latest"
        pullPolicy: Never
      port: 50054
      topics:
        - "transaction.*"

logging:
  level: debug
