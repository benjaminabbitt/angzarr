# Fast development values for angzarr
# Uses local registry (localhost:5001) for faster image loading
# Create cluster with: just kind-create-registry
# Deploy with: just deploy-fast

replicaCount: 1

# Global image registry prefix for local registry
global:
  imageRegistry: "localhost:5001"
  # Allow non-bitnami images (required for local registry)
  security:
    allowInsecureImages: true

image:
  repository: evented
  pullPolicy: Always
  tag: "dev"

images:
  aggregate:
    repository: localhost:5001/angzarr-aggregate
    pullPolicy: Always
    tag: "dev"
  projector:
    repository: localhost:5001/angzarr-projector
    pullPolicy: Always
    tag: "dev"
  saga:
    repository: localhost:5001/angzarr-saga
    pullPolicy: Always
    tag: "dev"
  stream:
    repository: localhost:5001/angzarr-stream
    pullPolicy: Always
    tag: "dev"
  gateway:
    repository: localhost:5001/angzarr-gateway
    pullPolicy: Always
    tag: "dev"

resources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "256Mi"
    cpu: "250m"

# MongoDB storage
storage:
  type: mongodb
  mongodb:
    uri: "mongodb://angzarr:angzarr@angzarr-mongodb:27017"
    database: "angzarr"

# AMQP for event bus
amqp:
  enabled: true
  url: "amqp://guest:guest@angzarr-rabbitmq:5672"

# RabbitMQ subchart
rabbitmq:
  enabled: true
  auth:
    username: "guest"
    password: "guest"
  persistence:
    size: 1Gi
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "250m"

# MongoDB subchart
mongodb:
  enabled: true
  auth:
    rootUsername: "root"
    rootPassword: "rootpassword"
    usernames: ["angzarr"]
    passwords: ["angzarr"]
    databases: ["angzarr"]
  persistence:
    size: 2Gi
  # Recreate strategy avoids mongod.lock conflicts during rolling updates
  updateStrategy:
    type: Recreate
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Infrastructure services
infrastructure:
  stream:
    enabled: true
    replicas: 1
    port: 1315
  gateway:
    enabled: true
    replicas: 1
    port: 1316
    streamTimeoutSecs: 30

# Rust example applications with local registry
applications:
  business:
    - name: entity-customer-rs
      image:
        repository: localhost:5001/entity-customer-rs
        tag: "dev"
        pullPolicy: Always
      domain: "customer"
      port: 50052

    - name: entity-transaction-rs
      image:
        repository: localhost:5001/entity-transaction-rs
        tag: "dev"
        pullPolicy: Always
      domain: "transaction"
      port: 50053

  projectors:
    - name: projector-receipt-rs
      image:
        repository: localhost:5001/projector-receipt-rs
        tag: "dev"
        pullPolicy: Always
      port: 50055
      topics:
        - "transaction.*"

    - name: projector-log-customer-rs
      image:
        repository: localhost:5001/projector-log-customer-rs
        tag: "dev"
        pullPolicy: Always
      port: 50056
      topics:
        - "customer.*"

    - name: projector-log-transaction-rs
      image:
        repository: localhost:5001/projector-log-transaction-rs
        tag: "dev"
        pullPolicy: Always
      port: 50057
      topics:
        - "transaction.*"

  sagas:
    - name: saga-loyalty-rs
      image:
        repository: localhost:5001/saga-loyalty-rs
        tag: "dev"
        pullPolicy: Always
      port: 50054
      topics:
        - "transaction.*"

# Enable remote debugging with gdb (adds SYS_PTRACE capability)
# Debug ports are calculated: grpc_port + 1
debug:
  enabled: true

logging:
  level: debug
