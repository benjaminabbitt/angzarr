# Fast development values for angzarr
# Uses local registry (ghcr.io/angzarr-io) for faster image loading
# Create cluster with: just kind-create-registry
# Deploy with: just deploy-fast

replicaCount: 1

# Global image registry prefix for local registry
global:
  imageRegistry: "ghcr.io/angzarr-io"
  # Allow non-bitnami images (required for local registry)
  security:
    allowInsecureImages: true

image:
  repository: evented
  pullPolicy: Always
  tag: "dev"

images:
  aggregate:
    repository: ghcr.io/angzarr-io/angzarr-aggregate
    pullPolicy: Always
    tag: "dev"
  projector:
    repository: ghcr.io/angzarr-io/angzarr-projector
    pullPolicy: Always
    tag: "dev"
  saga:
    repository: ghcr.io/angzarr-io/angzarr-saga
    pullPolicy: Always
    tag: "dev"
  stream:
    repository: ghcr.io/angzarr-io/angzarr-stream
    pullPolicy: Always
    tag: "dev"
  gateway:
    repository: ghcr.io/angzarr-io/angzarr-gateway
    pullPolicy: Always
    tag: "dev"

resources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "256Mi"
    cpu: "250m"

# PostgreSQL storage
storage:
  type: postgres
  postgres:
    uri: "postgres://angzarr:angzarr@angzarr-postgresql:5432/angzarr"

# AMQP for event bus
amqp:
  enabled: true
  url: "amqp://guest:guest@angzarr-rabbitmq:5672"

# RabbitMQ subchart
rabbitmq:
  enabled: true
  auth:
    username: "guest"
    password: "guest"
  persistence:
    size: 1Gi
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "250m"

# PostgreSQL subchart
postgresql:
  enabled: true
  auth:
    postgresPassword: "postgres"
    username: "angzarr"
    password: "angzarr"
    database: "angzarr"
  primary:
    persistence:
      size: 2Gi
    resources:
      requests:
        memory: "128Mi"
        cpu: "50m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# Infrastructure services
infrastructure:
  stream:
    enabled: true
    replicas: 1
    port: 1315
  gateway:
    enabled: true
    replicas: 1
    port: 1316
    streamTimeoutSecs: 30

# Rust example applications with local registry
applications:
  business:
    - name: entity-customer-rs
      image:
        repository: ghcr.io/angzarr-io/entity-customer-rs
        tag: "dev"
        pullPolicy: Always
      domain: "customer"
      port: 50052

    - name: entity-transaction-rs
      image:
        repository: ghcr.io/angzarr-io/entity-transaction-rs
        tag: "dev"
        pullPolicy: Always
      domain: "transaction"
      port: 50053

  projectors:
    - name: projector-receipt-rs
      image:
        repository: ghcr.io/angzarr-io/projector-receipt-rs
        tag: "dev"
        pullPolicy: Always
      port: 50055
      topics:
        - "transaction.*"

    - name: projector-log-customer-rs
      image:
        repository: ghcr.io/angzarr-io/projector-log-customer-rs
        tag: "dev"
        pullPolicy: Always
      port: 50056
      topics:
        - "customer.*"

    - name: projector-log-transaction-rs
      image:
        repository: ghcr.io/angzarr-io/projector-log-transaction-rs
        tag: "dev"
        pullPolicy: Always
      port: 50057
      topics:
        - "transaction.*"

  sagas:
    - name: saga-loyalty-rs
      image:
        repository: ghcr.io/angzarr-io/saga-loyalty-rs
        tag: "dev"
        pullPolicy: Always
      port: 50054
      topics:
        - "transaction.*"

# Enable remote debugging with gdb (adds SYS_PTRACE capability)
# Debug ports are calculated: grpc_port + 1
debug:
  enabled: true

logging:
  level: debug
