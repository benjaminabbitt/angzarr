# Go example applications for local development
# Deploy with: helm upgrade --install angzarr ./deploy/helm/angzarr -f ./deploy/helm/angzarr/values-go.yaml -n angzarr --create-namespace
#
# =============================================================================
# Port Scheme - Go (501xx range, 10 ports per domain)
# =============================================================================
# x0: sidecar gRPC (via service.aggregatePort)
# x1: sidecar debug
# x5: business gRPC
# x6: business debug
#
# customer:           50100-50109  (business: 50105)
# product:            50110-50119  (business: 50115)
# inventory:          50120-50129  (business: 50125)
# order:              50130-50139  (business: 50135)
# cart:               50140-50149  (business: 50145)
# fulfillment:        50150-50159  (business: 50155)
# saga-loyalty-earn:  50160-50169  (business: 50165)
# saga-fulfillment:   50170-50179  (business: 50175)
# saga-cancellation:  50180-50189  (business: 50185)
# =============================================================================

global:
  security:
    allowInsecureImages: true

replicaCount: 1

images:
  aggregate:
    repository: localhost:5001/angzarr-aggregate
    pullPolicy: IfNotPresent
    tag: "latest"
  projector:
    repository: localhost:5001/angzarr-projector
    pullPolicy: IfNotPresent
    tag: "latest"
  saga:
    repository: localhost:5001/angzarr-saga
    pullPolicy: IfNotPresent
    tag: "latest"
  stream:
    repository: localhost:5001/angzarr-stream
    pullPolicy: IfNotPresent
    tag: "latest"
  gateway:
    repository: localhost:5001/angzarr-gateway
    pullPolicy: IfNotPresent
    tag: "latest"

resources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "256Mi"
    cpu: "250m"

applicationResources:
  requests:
    memory: "32Mi"
    cpu: "25m"
  limits:
    memory: "128Mi"
    cpu: "100m"

storage:
  type: mongodb
  existingSecret: "angzarr-db-mongodb-credentials"
  mongodb:
    uri: ""
    database: ""

amqp:
  enabled: true
  existingSecret: "angzarr-mq-credentials"
  url: ""

rabbitmq:
  enabled: false

mongodb:
  enabled: false

infrastructure:
  stream:
    enabled: true
    replicas: 1
    port: 1340
    projectorPort: 1345
    serviceType: NodePort
    nodePort: 31340
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "250m"

  gateway:
    enabled: true
    replicas: 1
    port: 1350
    serviceType: NodePort
    nodePort: 31350
    streamService: "angzarr-stream:1340"
    streamTimeoutSecs: 30
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "250m"

applications:
  business:
    # E-commerce Domain Aggregates (Go: 501xx range)
    - name: aggregate-customer-go
      image:
        repository: localhost:5001/aggregate-customer-go
        tag: "latest"
        pullPolicy: IfNotPresent
      domain: "customer"
      port: 50105        # customer business gRPC (50100+5)

    - name: aggregate-product-go
      image:
        repository: localhost:5001/aggregate-product-go
        tag: "latest"
        pullPolicy: IfNotPresent
      domain: "product"
      port: 50115        # product business gRPC (50110+5)

    - name: aggregate-inventory-go
      image:
        repository: localhost:5001/aggregate-inventory-go
        tag: "latest"
        pullPolicy: IfNotPresent
      domain: "inventory"
      port: 50125        # inventory business gRPC (50120+5)

    - name: aggregate-order-go
      image:
        repository: localhost:5001/aggregate-order-go
        tag: "latest"
        pullPolicy: IfNotPresent
      domain: "order"
      port: 50135        # order business gRPC (50130+5)

    - name: aggregate-cart-go
      image:
        repository: localhost:5001/aggregate-cart-go
        tag: "latest"
        pullPolicy: IfNotPresent
      domain: "cart"
      port: 50145        # cart business gRPC (50140+5)

    - name: aggregate-fulfillment-go
      image:
        repository: localhost:5001/aggregate-fulfillment-go
        tag: "latest"
        pullPolicy: IfNotPresent
      domain: "fulfillment"
      port: 50155        # fulfillment business gRPC (50150+5)

  projectors: []

  sagas:
    - name: saga-loyalty-earn-go
      image:
        repository: localhost:5001/saga-loyalty-earn-go
        tag: "latest"
        pullPolicy: IfNotPresent
      port: 50165        # saga-loyalty-earn business gRPC (50160+5)
      topics:
        - "order.*"

    - name: saga-fulfillment-go
      image:
        repository: localhost:5001/saga-fulfillment-go
        tag: "latest"
        pullPolicy: IfNotPresent
      port: 50175        # saga-fulfillment business gRPC (50170+5)
      topics:
        - "order.*"

    - name: saga-cancellation-go
      image:
        repository: localhost:5001/saga-cancellation-go
        tag: "latest"
        pullPolicy: IfNotPresent
      port: 50185        # saga-cancellation business gRPC (50180+5)
      topics:
        - "order.*"

service:
  type: NodePort
  aggregatePort: 1310
  queryPort: 1315
  nodePort:
    enabled: true
    aggregate: 31310

# Enable remote debugging (adds SYS_PTRACE capability)
# Note: Go uses delve for debugging, not gdb
debug:
  enabled: true

logging:
  level: info

autoscaling:
  enabled: false

reloader:
  enabled: false

serviceDiscovery:
  headless: false
