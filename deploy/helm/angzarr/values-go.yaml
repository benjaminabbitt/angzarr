# Go example applications for local development
# Deploy with: helm upgrade --install angzarr ./deploy/helm/angzarr -f ./deploy/helm/angzarr/values-go.yaml -n angzarr --create-namespace

global:
  security:
    allowInsecureImages: true

replicaCount: 1

images:
  entity:
    repository: angzarr-entity
    pullPolicy: Never
    tag: "latest"
  projector:
    repository: angzarr-projector
    pullPolicy: Never
    tag: "latest"
  saga:
    repository: angzarr-saga
    pullPolicy: Never
    tag: "latest"
  stream:
    repository: angzarr-stream
    pullPolicy: Never
    tag: "latest"
  gateway:
    repository: angzarr-gateway
    pullPolicy: Never
    tag: "latest"

resources:
  requests:
    memory: "64Mi"
    cpu: "50m"
  limits:
    memory: "256Mi"
    cpu: "250m"

applicationResources:
  requests:
    memory: "32Mi"
    cpu: "25m"
  limits:
    memory: "128Mi"
    cpu: "100m"

storage:
  type: mongodb
  mongodb:
    uri: "mongodb://angzarr:angzarr@angzarr-mongodb:27017"
    database: "angzarr"

amqp:
  enabled: true
  url: "amqp://guest:guest@angzarr-rabbitmq:5672"

rabbitmq:
  enabled: true
  image:
    registry: docker.io
    repository: library/rabbitmq
    tag: "3.13-management-alpine"
    pullPolicy: Never
  auth:
    username: "guest"
    password: "guest"
  persistence:
    size: 1Gi
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "250m"

mongodb:
  enabled: true
  image:
    registry: docker.io
    repository: library/mongo
    tag: "7"
    pullPolicy: Never
  auth:
    rootUsername: "root"
    rootPassword: "rootpassword"
    usernames: ["angzarr"]
    passwords: ["angzarr"]
    databases: ["angzarr"]
  persistence:
    size: 2Gi
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "500m"

infrastructure:
  stream:
    enabled: false
  gateway:
    enabled: true
    replicas: 1
    port: 1316
    entities:
      customer: "angzarr-entity-customer-go:50051"
      transaction: "angzarr-entity-transaction-go:50051"
    streamService: "angzarr-stream-go:1315"
    streamTimeoutSecs: 30
    resources:
      requests:
        memory: "32Mi"
        cpu: "25m"
      limits:
        memory: "128Mi"
        cpu: "100m"

applications:
  business:
    - name: entity-customer-go
      image:
        repository: entity-customer-go
        tag: "latest"
        pullPolicy: Never
      domain: "customer"
      port: 50100

    - name: entity-transaction-go
      image:
        repository: entity-transaction-go
        tag: "latest"
        pullPolicy: Never
      domain: "transaction"
      port: 50101

  projectors:
    - name: stream-go
      image:
        repository: angzarr-stream
        tag: "latest"
        pullPolicy: Never
      port: 1315
      topics:
        - "#"

    - name: projector-receipt-go
      image:
        repository: projector-receipt-go
        tag: "latest"
        pullPolicy: Never
      port: 50103
      topics:
        - "transaction.*"

    - name: projector-log-customer-go
      image:
        repository: projector-log-customer-go
        tag: "latest"
        pullPolicy: Never
      port: 50104
      topics:
        - "customer.*"

    - name: projector-log-transaction-go
      image:
        repository: projector-log-transaction-go
        tag: "latest"
        pullPolicy: Never
      port: 50105
      topics:
        - "transaction.*"

  sagas:
    - name: saga-loyalty-go
      image:
        repository: saga-loyalty-go
        tag: "latest"
        pullPolicy: Never
      port: 50102
      topics:
        - "transaction.*"

service:
  type: NodePort
  entityPort: 50051
  queryPort: 50052

logging:
  level: info

autoscaling:
  enabled: false

reloader:
  enabled: false

serviceDiscovery:
  headless: false
