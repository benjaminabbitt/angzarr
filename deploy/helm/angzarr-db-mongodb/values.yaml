# MongoDB configuration for Angzarr
# Wraps Bitnami MongoDB chart with angzarr defaults

# Namespace where angzarr is deployed
angzarrNamespace: angzarr

# MongoDB subchart configuration
mongodb:
  # Authentication
  auth:
    # Required: set via --set or values file, never commit credentials
    rootUsername: "root"
    rootPassword: ""  # Set via --set mongodb.auth.rootPassword=<password>
    usernames:
      - "angzarr"
    passwords:
      - ""  # Set via --set mongodb.auth.passwords[0]=<password>
    databases:
      - "angzarr"

  # Persistence
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""

  # Use Recreate strategy to avoid lock file conflicts during rolling updates.
  # RollingUpdate causes the new pod to fail with "mongod.lock" errors when
  # both pods try to access the same PVC simultaneously.
  updateStrategy:
    type: Recreate

  # Resources
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi

  # Metrics (optional)
  metrics:
    enabled: false
    serviceMonitor:
      enabled: false

# Connection info for angzarr applications
# These are informational - actual connection uses service DNS
connection:
  # Service name pattern: {{ .Release.Name }}-mongodb
  port: 27017
  database: "angzarr"
