# Default values for evented
# Evented runs as a sidecar providing event sourcing infrastructure

replicaCount: 1

# Evented sidecar image
image:
  repository: evented
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# Evented gRPC ports
service:
  type: ClusterIP
  commandPort: 1313
  queryPort: 1314

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: evented.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

# Resources for evented sidecar
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

livenessProbe:
  tcpSocket:
    port: command
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  tcpSocket:
    port: command
  initialDelaySeconds: 5
  periodSeconds: 5

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

nodeSelector: {}
tolerations: []
affinity: {}

# Storage configuration for evented
storage:
  # sqlite, redis, or bigtable
  type: sqlite
  sqlite:
    persistence:
      enabled: true
      size: 1Gi
      storageClass: ""
  redis:
    host: ""
    port: 6379
  bigtable:
    project: ""
    instance: ""
    table: "events"

# AMQP/RabbitMQ configuration for event bus
amqp:
  enabled: false
  url: "amqp://rabbitmq:5672"

# RabbitMQ subchart configuration
rabbitmq:
  enabled: false
  auth:
    # Required: set via --set or values file, never commit credentials
    username: ""
    password: ""
  persistence:
    size: 1Gi

# Main application containers - evented runs as sidecar to these
# Each application type gets evented infrastructure
applications:
  # Business logic applications - handle commands, produce events
  # Evented sidecar provides: BusinessCoordinator gRPC service
  business: []
  # - name: discount-service
  #   image:
  #     repository: discount-business
  #     tag: "latest"
  #   # Domain this business logic handles
  #   domain: "discounts"
  #   # Port the business logic exposes (evented calls this)
  #   port: 50051
  #   type: python  # python, go, or custom
  #   python:
  #     module: discount_logic
  #     path: /app/business
  #   # go:
  #   #   library: /app/libbusiness.so
  #   resources: {}

  # Projector applications - subscribe to events, build read models
  # Evented sidecar provides: EventQuery gRPC service
  # Application subscribes to AMQP and calls evented for event queries
  projectors: []
  # - name: order-projector
  #   image:
  #     repository: order-projector
  #     tag: "latest"
  #   # Event topics to subscribe to (AMQP routing keys)
  #   topics:
  #     - "orders.*"
  #     - "discounts.DiscountApplied"
  #   type: python
  #   python:
  #     module: order_projector
  #     path: /app/projectors
  #   resources: {}

  # Saga applications - subscribe to events, orchestrate transactions
  # Evented sidecar provides: BusinessCoordinator + EventQuery gRPC services
  # Application subscribes to AMQP and calls evented to issue commands
  sagas: []
  # - name: order-fulfillment
  #   image:
  #     repository: fulfillment-saga
  #     tag: "latest"
  #   # Event topics to subscribe to (AMQP routing keys)
  #   topics:
  #     - "orders.OrderCreated"
  #     - "payments.PaymentCompleted"
  #     - "inventory.ItemReserved"
  #   type: python
  #   python:
  #     module: fulfillment_saga
  #     path: /app/sagas
  #   resources: {}

# Default resources for application containers
applicationResources:
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 50m
    memory: 64Mi

# Environment variables
env: []

# Extra volumes
extraVolumes: []
extraVolumeMounts: []

# Logging
logging:
  level: info
  format: json
