# Istio mesh configuration for Angzarr

# Namespace where angzarr is deployed
angzarrNamespace: angzarr

# Ingress gateway configuration
gateway:
  # Name of the Istio ingress gateway deployment
  selector: istio-ingressgateway
  # Hosts to accept traffic for
  hosts:
    - "*"
  # Port configuration
  port: 80
  # TLS configuration (optional)
  tls:
    enabled: false
    mode: SIMPLE
    credentialName: ""

# Aggregate coordinator services
aggregates:
  # List of domains to route to
  domains:
    - name: order
      service: angzarr-agg-order-rs
      port: 1310
    - name: inventory
      service: angzarr-agg-inventory-rs
      port: 1310
    - name: fulfillment
      service: angzarr-agg-fulfillment-rs
      port: 1310

# EventStream service
stream:
  enabled: true
  service: angzarr-stream
  port: 1340

# mTLS configuration
mtls:
  enabled: true
  mode: STRICT  # STRICT or PERMISSIVE

# Traffic policy
trafficPolicy:
  connectionPool:
    http:
      h2UpgradePolicy: UPGRADE
      http2MaxRequests: 1000
    tcp:
      maxConnections: 100

  # Retry policy for gRPC
  retries:
    attempts: 3
    perTryTimeout: 5s
    retryOn: "connect-failure,refused-stream,unavailable,cancelled,resource-exhausted"

  # Request timeout
  timeout: 30s

  # Circuit breaker (outlier detection)
  outlierDetection:
    enabled: false
    consecutiveGatewayErrors: 5
    interval: 30s
    baseEjectionTime: 30s
    maxEjectionPercent: 50
